<Window x:Class="FamilyTreeApp.UI.Windows.ToolbarCustomizeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:FamilyTreeApp.UI.Converters"
        Title="Customize Toolbar" 
        Height="500" Width="450"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource PrimaryBackgroundBrush}">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
    </Window.Resources>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Customize Toolbar" 
                       FontSize="18" FontWeight="Bold" 
                       Foreground="{DynamicResource PrimaryTextBrush}"/>
            <TextBlock Text="Drag items to reorder. Right-click for options." 
                       FontSize="12" 
                       Foreground="{DynamicResource SecondaryTextBrush}"
                       Margin="0,4,0,0"/>
        </StackPanel>
        
        <!-- Tools List -->
        <Border Grid.Row="1" 
                Background="{DynamicResource TertiaryBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4">
            <ListBox x:Name="ToolsListBox" 
                     Background="Transparent"
                     BorderThickness="0"
                     AllowDrop="True"
                     PreviewMouseLeftButtonDown="ToolsListBox_PreviewMouseLeftButtonDown"
                     PreviewMouseMove="ToolsListBox_PreviewMouseMove"
                     Drop="ToolsListBox_Drop"
                     DragOver="ToolsListBox_DragOver">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Drag Handle -->
                            <TextBlock Grid.Column="0" Text="â‹®â‹®" 
                                       Foreground="{DynamicResource SecondaryTextBrush}"
                                       FontSize="14" 
                                       VerticalAlignment="Center"
                                       Margin="0,0,8,0"
                                       Cursor="SizeAll"/>
                            
                            <!-- Tool Display -->
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding DisplayText}" 
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsSeparator, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                            <TextBlock Grid.Column="1" 
                                       Text="â”€â”€ Separator â”€â”€" 
                                       Foreground="{DynamicResource SecondaryTextBrush}"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsSeparator, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            
                            <!-- Visibility Indicator -->
                            <TextBlock Grid.Column="2" 
                                       Text="ðŸ‘" 
                                       ToolTip="Visible"
                                       Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                                       Margin="8,0"/>
                            <TextBlock Grid.Column="2" 
                                       Text="ðŸ‘â€ðŸ—¨" 
                                       Opacity="0.4"
                                       ToolTip="Hidden"
                                       Visibility="{Binding IsVisible, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                       Margin="8,0"/>
                            
                            <!-- Built-in Indicator -->
                            <TextBlock Grid.Column="3" 
                                       Text="ðŸ”’" 
                                       ToolTip="Built-in (cannot delete)"
                                       Visibility="{Binding IsBuiltIn, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.ContextMenu>
                    <ContextMenu>
                        <MenuItem x:Name="HideMenuItem" Header="Hide" Click="Hide_Click"/>
                        <MenuItem x:Name="ShowMenuItem" Header="Show" Click="Show_Click"/>
                        <Separator/>
                        <MenuItem x:Name="DeleteMenuItem" Header="Delete" Click="Delete_Click"/>
                    </ContextMenu>
                </ListBox.ContextMenu>
            </ListBox>
        </Border>
        
        <!-- Hidden Tools Section -->
        <Expander Grid.Row="2" Header="Hidden Tools" Margin="0,8,0,0" IsExpanded="False">
            <ListBox x:Name="HiddenToolsListBox" 
                     Background="{DynamicResource TertiaryBackgroundBrush}"
                     MaxHeight="100">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding DisplayText}" Margin="0,0,8,0"/>
                            <Button Content="Show" Click="ShowHidden_Click" Tag="{Binding}" Padding="4,2"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Expander>
        
        <!-- Buttons -->
        <Grid Grid.Row="3" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <Button Content="âž• Add Tool" Click="AddTool_Click" Margin="0,0,8,0"/>
                <Button Content="âž• Add Separator" Click="AddSeparator_Click" Margin="0,0,8,0"/>
                <Button Content="Reset Defaults" Click="ResetDefaults_Click"/>
            </StackPanel>
            
            <Button Grid.Column="1" Content="Close" Click="Close_Click" Width="80"/>
        </Grid>
    </Grid>
</Window>
